<!doctype html>

<body>
Loading HIT...If you are stuck on this screen, please make sure you are using Google Chrome and have cookies enabled.
</body>

<head>
    <script src="//uniqueturker.myleott.com/lib.js" type="text/javascript"></script>
    <script type="text/javascript">
        //http://uniqueturker.myleott.com/

        // In the case where workers can accept a HIT which is designed for (un)qualified workers, this
        // code catches these workers and presents them with a splash screen asking them to return the HIT.
        allow_worker = true;
        NOVEL_WORKERS_ONLY = __NOVEL_WORKERS_ONLY_true_false__;
        if (NOVEL_WORKERS_ONLY) {
            (function(){
                var ut_id = 'c3f75daeee93e4f1c6bec080e1b06655';
                if (UTWorkerLimitReached(ut_id)) {
                    allow_worker = false;
                    document.getElementsByTagName('body')[0].innerHTML = "You have already completed the maximum number of HITs allowed by this requester for this HIT group. " +
                        "Please click 'Return HIT' to avoid any impact on your approval rating.";
                }
            })();
        }
    </script>


    <script>
        async function setupSession() {

            try {
                SESSION_PACKAGE = __SESSION_PACKAGE_GOES_HERE__;
            } catch (error) {
                console.log(error);
                SESSION_PACKAGE = undefined
            }

            var localSavePackage = {
                    'SESSION_PACKAGE': SESSION_PACKAGE,
                    'LANDING_PAGE_URL': window.location.href
                };

            await concludeLandingPage(localSavePackage)
        }

    </script>

    <script>
        async function concludeLandingPage(localSavePackage) {

            SESSION_PACKAGE = localSavePackage['SESSION_PACKAGE'];
            agentId = localSavePackage['agentId'];
            LANDING_PAGE_URL = localSavePackage['LANDING_PAGE_URL'];

            console.log('landing page url', window.location.href);

            await localStorage.setItem("SESSION_PACKAGE", btoa(JSON.stringify(SESSION_PACKAGE)));
            await localStorage.setItem('LANDING_PAGE_URL', btoa(LANDING_PAGE_URL));
            await localStorage.setItem('agentId', btoa(agentId));

            console.log('All items stored. Redirecting...');
            await new Promise(resolve => setTimeout(resolve, 1000));
            go_to_main_page()
        }

        function go_to_main_page() {
            var currentURL = window.location.href;
            if (currentURL.indexOf('localhost') !== -1) {
                window.location.href = '/public/ptap.html?loadtime=' + Math.round(window.performance.timing.navigationStart)
            } else {
                s3_bucket = __S3_INSTALL_BUCKET_GOES_HERE__;
                window.location.href = "https://s3.amazonaws.com/" + s3_bucket + "/public/ptap.html?loadtime=" + Math.round(window.performance.timing.navigationStart)
            }
        }

    </script>


    <script>
        if (allow_worker){
            (async function () {
                    await setupSession();
                }
            )();
        }
    </script>
    <title>ptap landing page</title>

</head>


</html>